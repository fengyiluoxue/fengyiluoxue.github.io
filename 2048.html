<!DOCTYPE html>
<html>

<head>
    <title>2048 Game</title>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        h1 {
            font-size: 40px;
        }

        #score {
            font-size: 24px;
            margin-bottom: 20px;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-gap: 10px;
            width: 80vw;
            /* 使用相对于视口宽度的单位 */
            max-width: 400px;
            /* 设置最大宽度，以防止游戏面板过宽 */
            height: 80vw;
            /* 使用相对于视口宽度的单位 */
            max-height: 400px;
            /* 设置最大高度，以防止游戏面板过高 */
            margin: 0 auto;
            background-color: #bbada0;
            padding: 10px;
            border-radius: 5px;
        }

        .tile {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            background-color: #cdc1b4;
            border-radius: 5px;
        }

        #buttons {
            margin-top: 20px;
        }

        button {
            font-size: 24px;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            background-color: #eee;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #ddd;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>2048 Game</h1>
        <div id="score">Score: 0</div>
        <div id="board"></div>
        <div id="buttons">
            <button id="btn-up">↑</button>
            <button id="btn-down">↓</button>
            <button id="btn-left">←</button>
            <button id="btn-right">→</button>
        </div>
    </div>

    <script>
        // 游戏逻辑
        var board = [];
        var score = 0;

        function startGame() {
            // 初始化游戏面板
            board = [];
            score = 0;
            for (var i = 0; i < 4; i++) {
                board[i] = [];
                for (var j = 0; j < 4; j++) {
                    board[i][j] = 0;
                }
            }

            // 随机生成两个初始数字
            generateNumber();
            generateNumber();

            // 更新游戏面板显示
            updateBoardView();
        }

        function generateNumber() {
            if (isBoardFull()) {
                return;
            }

            // 随机生成数字2或4
            var value = Math.random() < 0.9 ? 2 : 4;

            // 随机选择一个空位置
            var row, col;
            do {
                row = Math.floor(Math.random() * 4);
                col = Math.floor(Math.random() * 4);
            } while (board[row][col] !== 0);

            // 在空位置上放置生成的数字
            board[row][col] = value;
        }

        function isBoardFull() {
            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    if (board[i][j] === 0) {
                        return false;
                    }
                }
            }
            return true;
        }

        function updateBoardView() {
            var boardElement = document.getElementById("board");
            boardElement.innerHTML = "";

            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    var tile = document.createElement("div");
                    tile.className = "tile";
                    tile.innerText = board[i][j] === 0 ? "" : board[i][j];
                    tile.style.backgroundColor = getTileColor(board[i][j]);
                    boardElement.appendChild(tile);
                }
            }

            document.getElementById("score").innerText = "Score: " + score;
        }

        function getTileColor(value) {
            switch (value) {
                case 2: return "#eee4da";
                case 4: return "#ede0c8";
                case 8: return "#f2b179";
                case 16: return "#f59563";
                case 32: return "#f67c5f";
                case 64: return "#f65e3b";
                case 128: return "#edcf72";
                case 256: return "#edcc61";
                case 512: return "#edc850";
                case 1024: return "#edc53f";
                case 2048: return "#edc22e";
                default: return "#cdc1b4";
            }
        }

        function move(direction) {
            var moved = false;

            switch (direction) {
                case "up":
                    moved = moveUp();
                    break;
                case "down":
                    moved = moveDown();
                    break;
                case "left":
                    moved = moveLeft();
                    break;
                case "right":
                    moved = moveRight();
                    break;
            }

            if (moved) {
                generateNumber();
                updateBoardView();

                if (isGameOver()) {
                    alert("Game Over!");
                }
            }
        }

        function moveUp() {
            var moved = false;

            for (var j = 0; j < 4; j++) {
                for (var i = 1; i < 4; i++) {
                    if (board[i][j] !== 0) {
                        for (var k = i; k > 0; k--) {
                            if (board[k - 1][j] === 0 || board[k - 1][j] === board[k][j]) {
                                if (board[k - 1][j] === 0) {
                                    board[k - 1][j] = board[k][j];
                                } else {
                                    board[k - 1][j] *= 2;
                                    score += board[k - 1][j];
                                }
                                board[k][j] = 0;
                                moved = true;
                            } else {
                                break;
                            }
                        }
                    }
                }
            }

            return moved;
        }

        function moveDown() {
            var moved = false;

            for (var j = 0; j < 4; j++) {
                for (var i = 2; i >= 0; i--) {
                    if (board[i][j] !== 0) {
                        for (var k = i; k < 3; k++) {
                            if (board[k + 1][j] === 0 || board[k + 1][j] === board[k][j]) {
                                if (board[k + 1][j] === 0) {
                                    board[k + 1][j] = board[k][j];
                                } else {
                                    board[k + 1][j] *= 2;
                                    score += board[k + 1][j];
                                }
                                board[k][j] = 0;
                                moved = true;
                            } else {
                                break;
                            }
                        }
                    }
                }
            }

            return moved;
        }

        function moveLeft() {
            var moved = false;

            for (var i = 0; i < 4; i++) {
                for (var j = 1; j < 4; j++) {
                    if (board[i][j] !== 0) {
                        for (var k = j; k > 0; k--) {
                            if (board[i][k - 1] === 0 || board[i][k - 1] === board[i][k]) {
                                if (board[i][k - 1] === 0) {
                                    board[i][k - 1] = board[i][k];
                                } else {
                                    board[i][k - 1] *= 2;
                                    score += board[i][k - 1];
                                }
                                board[i][k] = 0;
                                moved = true;
                            } else {
                                break;
                            }
                        }
                    }
                }
            }

            return moved;
        }

        function moveRight() {
            var moved = false;

            for (var i = 0; i < 4; i++) {
                for (var j = 2; j >= 0; j--) {
                    if (board[i][j] !== 0) {
                        for (var k = j; k < 3; k++) {
                            if (board[i][k + 1] === 0 || board[i][k + 1] === board[i][k]) {
                                if (board[i][k + 1] === 0) {
                                    board[i][k + 1] = board[i][k];
                                } else {
                                    board[i][k + 1] *= 2;
                                    score += board[i][k + 1];
                                }
                                board[i][k] = 0;
                                moved = true;
                            } else {
                                break;
                            }
                        }
                    }
                }
            }

            return moved;
        }

        function isGameOver() {
            if (!isBoardFull()) {
                return false;
            }

            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    if ((i < 3 && board[i][j] === board[i + 1][j]) ||
                        (j < 3 && board[i][j] === board[i][j + 1])) {
                        return false;
                    }
                }
            }

            return true;
        }

        // 游戏开始
        startGame();

        // 绑定按钮事件
        document.getElementById("btn-up").addEventListener("click", function () {
            move("up");
        });

        document.getElementById("btn-down").addEventListener("click", function () {
            move("down");
        });

        document.getElementById("btn-left").addEventListener("click", function () {
            move("left");
        });

        document.getElementById("btn-right").addEventListener("click", function () {
            move("right");
        });
    </script>
</body>

</html>